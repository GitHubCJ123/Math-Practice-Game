# Monthly cron backup to trigger score archival on Vercel.
# Vercel's own cron also fires â€” the endpoint is idempotent so double-firing is harmless.

name: Monthly Score Archive (Backup)

on:
  schedule:
    # Midnight EST on the 1st of every month (05:00 UTC)
    - cron: '0 5 1 * *'
  workflow_dispatch:

jobs:
  archive-scores:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger archive-scores endpoint
        env:
          CRON_SECRET: ${{ secrets.CRON_SECRET }}
          VERCEL_URL: ${{ secrets.VERCEL_URL }}
        run: |
          echo "Triggering score archive at $(date -u)"
          HTTP_STATUS=$(curl -s -o /dev/null -w "%{http_code}" \
            -X POST "${VERCEL_URL}/api/archive-scores" \
            -H "Authorization: Bearer ${CRON_SECRET}" \
            -H "Content-Type: application/json")
          echo "Response status: $HTTP_STATUS"
          if [ "$HTTP_STATUS" -ne 200 ]; then
            echo "::error::Archive endpoint returned HTTP $HTTP_STATUS"
            exit 1
          fi
          